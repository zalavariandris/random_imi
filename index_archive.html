<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Google Sheet Table</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { padding: 2rem; background: #f8f9fa; }
        #randomBox { display:none; }
        .cell-box {
            padding: 10px;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            background: white;
            margin-bottom: 8px;
        }
        .cell-label {
            font-weight: 600;
            color: #444;
            font-size: 0.85rem;
            margin-bottom: 2px;
        }
        .cell-value {
            font-size: 1rem;
        }
    </style>
</head>
<body>

<h2>Google Sheet Data</h2>

<!-- Random Row Box -->
<div id="randomBox" class="alert alert-primary p-3 mb-4">
    <h5 class="mb-3">Random choice:</h5>
    <div id="randomContent"></div>
</div>

<button class="btn btn-success mb-3" id="randomBtn">Choose for me</button>

<!-- Loading progress -->
<div id="loading" class="my-3">
    <div class="progress" style="height: 20px;">
        <div id="loadingBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" style="width: 0%"></div>
    </div>
</div>

<!-- Table -->
<div class="table-responsive">
    <table id="sheetTable" class="table table-bordered table-striped"></table>
</div>

<script>
// -----------------------------------------------------
// CONFIG: Your Google Sheet
// -----------------------------------------------------
const SHEET_ID = "1MqRSj_s91_i1is965PLkFtHD6QEym8SS3Z6I5PPNzfU";  // required
const SHEET_NAME = "Sheet1";    // optional
// -----------------------------------------------------

let ROW_DATA = [];
let HEADERS = [];

function setProgress(percent) {
    document.getElementById("loadingBar").style.width = percent + "%";
}

async function loadSheet() {
    setProgress(10);

    const base = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?`;
    const params = new URLSearchParams({ tqx: "out:json" });
    if (SHEET_NAME) params.set("sheet", SHEET_NAME);

    const url = base + params.toString();

    setProgress(30);

    const response = await fetch(url);
    setProgress(60);

    const text = await response.text();
    setProgress(80);

    const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);?/);
    const json = JSON.parse(match[1]);

    renderTable(json);

    setProgress(100);
    setTimeout(() => document.getElementById("loading").style.display = "none", 300);

    // Extract headers
    HEADERS = json.table.cols.map(c => c.label || "");

    // Extract rows
    ROW_DATA = json.table.rows.map(r =>
        json.table.cols.map((_, i) => {
            const cell = r.c[i];
            return cell ? (cell.f ?? cell.v ?? "") : "";
        })
    );

    document.getElementById("randomBox").style.display = "block";
}

function renderTable(json) {
    const table = document.getElementById("sheetTable");
    table.innerHTML = "";

    const cols = json.table.cols;
    const rows = json.table.rows;

    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    cols.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col.label || "";
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    rows.forEach(r => {
        const tr = document.createElement("tr");
        cols.forEach((_, i) => {
            const cell = r.c[i];
            const value = cell ? (cell.f ?? cell.v ?? "") : "";
            const td = document.createElement("td");
            td.textContent = value;
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
    table.appendChild(tbody);
}

// Random row selection formatted as sections
document.getElementById("randomBtn").addEventListener("click", () => {
    if (ROW_DATA.length === 0) return;
        
    const random = ROW_DATA[Math.floor(Math.random() * ROW_DATA.length)];
    const container = document.getElementById("randomContent");
    container.innerHTML = "";

    random.forEach((value, index) => {
        const div = document.createElement("div");
        div.className = "cell-box";

        div.innerHTML = `
            <div class="cell-label">${HEADERS[index] || "Column " + (index + 1)}</div>
            <div class="cell-value">${value}</div>
        `;

        container.appendChild(div);
    });
});

// Load sheet
loadSheet();
</script>

</body>
</html>
